Ext.define("Afisha.controller.AfishaC.FilterView",{extend:"Ext.app.Controller",config:{views:["AfishaViews.FilterView","AfishaViews.Events"],refs:{view:"filterview",eventView:"events",fieldset:"filterview fieldset",filterButton:"filterview > button",sortButton:"filterview > segmentedbutton"},control:{sortButton:{toggle:"onSortPressed"},view:{construct:"onConstruct"},filterButton:{tap:"onOK"}}},onSortPressed:function(a,b,c){Ext.Viewport.remove(this.getView());this.getEventView().fireEvent("sortBy",b.getId())},onOK:function(){var a=this.getView().getValues();this.getEventView().fireEvent("setFilter",a);Ext.Viewport.remove(this.getView())},onConstruct:function(f){var b=Ext.getStore("Categories");var n=b.find("id",f);if(n<0){alert("Нет такой категории")}else{var a=b.getAt(n).get("filter").items;var c=Ext.getStore("Dictionary");for(var h in a){var g=c.find("id",a[h].id);if(g<0){continue}var l=c.getAt(g);var e=l.get("data");var o=[];for(var m in e){o.push({text:e[m],value:m})}var j=Ext.create("widget.selectfield",{name:a[h].id,label:a[h].name,options:o,autoSelect:false,value:0});this.getFieldset().add(j)}}}});