Ext.define("Afisha.controller.MapView",{extend:"Ext.app.Controller",config:{refs:{viewport:"aviewport",mapView:"aviewport mapview",mapEl:"aviewport mapview map"},control:{mapEl:{maprender:"onMapRender",updatedata:"onUpdateData"}}},goBack:function(){return false},onMapRender:function(c,f){f=c.getMap();var b=Ext.ComponentQuery.query("map")[0];var d=b.getData();var e=d.latitude;var a=d.longitude;c.setMapCenter({latitude:e,longitude:a});b.marker=new google.maps.Marker({position:position=new google.maps.LatLng(e,a),map:f,})},onUpdateData:function(c){var f=c.getMap();var b=Ext.ComponentQuery.query("map")[0];var d=b.getData();var e=d.latitude;var a=d.longitude;c.setMapCenter({latitude:e,longitude:a});if(b.marker){b.marker.setMap(null)}b.marker=new google.maps.Marker({position:position=new google.maps.LatLng(e,a),map:f,});b.marker.setMap(f);setTimeout(function(){c.setMapCenter({latitude:e,longitude:a})},100)},initView:function(a){if((typeof google=="undefined")||!google.maps){Afisha.gf.alert("Карта не может быть загружена.");return}this.getMapEl().setData(a)},});