Ext.define("Afisha.util.schMethods",{alternateClassName:"Afisha.schMethods",config:{},statics:{compareDates:function(c,f,e){switch(c){case"week":var b=new Date();var a=b.format("Y-m-d");for(var d=b.format("w");d<7;d++){b.nextDay()}if(e){return((e>=a)&&(f<=b.format("Y-m-d")))}else{return((f>=a)&&(f<=b.format("Y-m-d")))}case"nextweek":var b=new Date();var a;for(var d=b.format("w");d<14;d++){if((d-1)==7){a=b.format("Y-m-d")}b.nextDay()}if(e){return((e>=a)&&(f<=b.format("Y-m-d")))}else{return((f>=a)&&(f<=b.format("Y-m-d")))}default:if(e){return((c.format("Y-m-d")>=f)&&(c.format("Y-m-d")<=e))}else{return(f==c.format("Y-m-d"))}}},isComingSoon:function(a,b){var c=true;Afisha.stores.cinemaScheduleStore.each(function(d){if((d.data.film_id===a)&&d.data.price.length){c=false;return false}return true});return c},getSchedule:function(h,e,k){var d=Ext.getStore("Schedule");var i=Ext.getStore("Places");var g=Ext.getStore("Events");var l={data:[],cache:[]};var f=k?"event":"place";var b=!k?"place_id":"event_id";var a=k?"place_id":"event_id";var j=k?i:g;var c=new Date();d.each(function(n){if((n.data[b]==this.id)&&((n.data.start_date>c.format("Y-m-d"))||((n.data.start_date==c.format("Y-m-d"))&&(n.data.start_time>=c.format("H:i")))||(n.data.finish_date>=c.format("Y-m-d")))){var m=l.cache.indexOf(n.data[a]+n.data.start_date);if(m==-1){var o={};o.ep=j.getById(n.data[a]);if(o.ep==null){return}o.isSchedule=true;o.schedule=[];o.date=n.data.start_date;if(n.data.finish_date){o.finish_date=n.data.finish_date}o.schedule.push({time:n.data.finish_time?n.data.start_time+" - "+n.data.finish_time:n.data.start_time,price:n.data.price});l.data.push(o);l.cache.push(n.data[a]+n.data.start_date)}else{l.data[m].schedule.push({time:n.data.finish_time?n.data.start_time+" - "+n.data.finish_time:n.data.start_time,price:n.data.price})}}},{id:e});return l.data},getScheduleByDate:function(c,b){var a=[];if(!c.length){a.push({date:null});return a}if((c.length==1)||!b){return c}c.forEach(function(d){if(Afisha.schMethods.compareDates(b,d.date,d.finish_date)){a.push(d)}});if(!a.length&&b&&(b!="week")&&(b!="nextweek")){a.push({date:b.format("Y-m-d")})}if(!a.length&&(!b||(b=="week")||(b=="nextweek"))){a.push({date:null})}return a},getMonthName:function(a){switch(a){case"01":return" января";case"02":return" февраля";case"03":return" марта";case"04":return" апреля";case"05":return" мая";case"06":return" июня";case"07":return" июля";case"08":return" августа";case"09":return" сентября";case"10":return" октября";case"11":return" ноября";case"12":return" декабря";default:return""}},getMonthShortName:function(a){switch(a){case"01":return" янв";case"02":return" фев";case"03":return" мар";case"04":return" апр";case"05":return" мая";case"06":return" июн";case"07":return" июл";case"08":return" авг";case"09":return" сен";case"10":return" окт";case"11":return" ноя";case"12":return" дек";default:return""}},getDayOfWeek:function(b){var a=new Date(b).getDay();switch(a){case 0:return" (воскресенье)";case 1:return" (понедельник)";case 2:return" (вторник)";case 3:return" (среда)";case 4:return" (четверг)";case 5:return" (пятница)";case 6:return" (суббота)";default:return""}},getGroupString:function(a){var b=a.get("date");var d="";if(!b){var c=a.get("ob_type");if(c=="place"){return"Услуги не заданы"}if(c=="event"){return"Места не заданы"}return"Событий нет"}if(b=="place"){return"Услуги"}if(b=="event"){return"Места"}var e=a.get("finish_date");d=Afisha.schMethods.getDayOfWeek(b);b=b.split("-");if(e){e=e.split("-")}if(b.length!=3){return""}if(!a.data.schedule||!a.data.schedule.length){return(b[2][0]=="0"?b[2][1]:b[2])+Afisha.schMethods.getMonthName(b[1])+" событий нет"}else{return e?"Расписание на "+(b[2][0]=="0"?b[2][1]:b[2])+Afisha.schMethods.getMonthName(b[1])+" - "+(e[2][0]=="0"?e[2][1]:e[2])+Afisha.schMethods.getMonthName(e[1]):"Расписание на "+(b[2][0]=="0"?b[2][1]:b[2])+Afisha.schMethods.getMonthName(b[1])+d}}},constructor:function(a){}});